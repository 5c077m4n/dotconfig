#!/usr/bin/env zsh

() {
	local root_dir="$(git rev-parse --show-toplevel)"
	local luacheck_config="${root_dir}/.luacheckrc"
	local stylua_config="${root_dir}/.stylua.toml"

	local file
	for file in $(git diff --name-only --staged); do
		[[ ! -f "$file" ]] && continue

		local file_ext="${file##*.}"
		if [[ "$file_ext" == "lua" ]]; then
			luacheck --config="$luacheck_config" "$file"
			stylua --config-path="$stylua_config" "$file"

			git add "$file"
		elif [[ "$file_ext" == "py" ]]; then
			black "$file"
			mypy --strict "$file"

			git add "$file"
		elif [[ "$file_ext" == "zsh" ]]; then
			beautysh --tab --force-function-style=fnpar "$file"

			git add "$file"
		fi
	done
}
